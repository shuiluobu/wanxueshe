<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wxs.mapper.comment.TDynamicmsgMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.wxs.entity.comment.TDynamicmsg">
        <id column="id" property="id"/>
        <result column="userId" property="userId"/>
        <result column="content" property="content"/>
        <result column="courseCateId" property="courseCateId"/>
        <result column="classId" property="classId"/>
        <result column="courseId" property="courseId"/>
        <result column="classLessonId" property="classLessonId"/>
        <result column="power" property="power"/>
        <result column="createTime" property="createTime"/>
        <result column="dynamicType" property="dynamicType"/>
        <!--<result column="createPlace" property="createPlace"/>-->
        <result column="longitude" property="longitude"/>
        <result column="latitude" property="latitude"/>
        <result column="dynamicType" property="dynamicType"/>
        <result column="studentId" property="studentId"/>
        <result column="status" property="status"/>
    </resultMap>
    <select id="getDynamicmsgByParam" resultType="java.util.HashMap" parameterType="map">
        <include refid="querySql"></include>
        INNER JOIN t_class f on f.id=d.classId
        <where>
             d.`status`=0
            <if test="power!=null">
                AND d.power in (#{power})
            </if>
            <if test="userId!=null">
                AND d.userId = #{userId}
            </if>
            <if test="courseId!=null">
                AND d.courseId = #{courseId}
            </if>
            <if test="classId!=null">
                AND d.classId = #{classId}
            </if>
            <if test="teacherId!=null">
                AND f.teacherId = #{teacherId}
            </if>
            <if test="courseCateId!=null">
                AND d.courseCateId = #{courseCateId}
            </if>
            <if test="classLessonId!=null">
                AND  d.classLessonId = #{classLessonId}
            </if>
            <if test="teacherId!=null">
                AND  d.teacherId = #{teacherId}
            </if>
        </where>
         ORDER BY d.createTime DESC

	</select>

    <select id="getFriendDynamicmsgByUserId" resultType="java.util.HashMap" parameterType="java.lang.Long">
        <include refid="querySql"></include>
        INNER JOIN t_friend f on f.fuserId=d.userId
        <where>
            d.`status`=0
            AND  power in (0,1)
            <if test="muserId!=null">
                AND d.muserId = #{muserId}
            </if>
        </where>
        ORDER BY d.createTime DESC
    </select>

    <sql id="querySql">
        SELECT
        d.id,
        d.userId,
        u.nickName,
        content,
        createPlace,
        DATE_FORMAT(d.createTime,'%Y-%m-%d %H:%i:%s') createTime,
        d.dynamicType,
        d.longitude,
        d.latitude,
        d.power
        FROM t_dynamicmsg d
        INNER JOIN t_front_user u ON u.id = d.userId
        LEFT JOIN t_organization o ON o.id=d.organId
    </sql>
</mapper>
